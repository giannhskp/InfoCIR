# CIR App - Compose Image Retrieval Application

This is a Dash-based web application for exploring image datasets through interactive visualizations. The app uses CLIP embeddings to create 2D UMAP projections of images and provides various widgets to explore class distributions.

## Features

- **Interactive Scatterplot**: Visualize CLIP embeddings in 2D using UMAP projections
- **Image Gallery**: Browse sample images from selected data points
- **Wordcloud**: View class distribution as a wordcloud
- **Histogram**: Analyze class frequency distributions
- **Class Highlighting**: Click on any visualization to highlight specific classes

## Setup

### 1. Install dependencies:
```bash
python3.11 -m venv ~/cir_app
source ~/cir_app/bin/activate
pip install -r requirements.txt
```

### 2. Prepare your dataset:

You need to have your dataset somewhere on your system with this structure:
```
/your/path/to/dataset/
├── class1_dir/           # class directory
├── class2_dir/           # class directory
├── ...
└── class_names.csv       # CSV with columns: dir_name,class_name
```

The `class_names.csv` should look like:
```csv
dir_name,class_name
class1_dir,Class 1 Name
class2_dir,Class 2 Name
...
```

### 3. Configure the dataset path:

Edit `src/config.py` and change:
```python
DATASET_ROOT_PATH = '/your/actual/path/to/dataset'
```

### 4. Run the application:
```bash
python run.py
```

## Directory Structure After Setup

```
cir_app/
├── data/                    # Generated by the app
│   ├── dataset.csv         # Processed dataset info
│   └── augmented_dataset.csv  # With CLIP embeddings & projections
├── src/                    # Application code
└── run.py                  # Start script
```

Your dataset stays in its original location - the app just reads from it.

## Configuration

Edit `src/config.py` to modify:
- `DATASET_SAMPLE_SIZE` - Number of images to process (default: 1000)
- `DATASET_ROOT_PATH` - Path to your dataset
- UI parameters (gallery size, wordcloud dimensions, etc.)

## Usage

1. The app will automatically process the dataset on first run (this may take a while for CLIP embeddings)
2. The app uses UMAP projection for visualization
3. Select areas on the scatterplot to explore subsets of data
4. Click on wordcloud terms, histogram bars, or gallery images to highlight classes
5. Use the "Deselect everything" button to clear selections

## What the App Does

1. **First run**: Scans your dataset, extracts CLIP embeddings, creates 2D projections
2. **Subsequent runs**: Loads the processed data and starts the interactive interface
3. **Data storage**: Processed data is saved in `cir_app/data/` (your original images are not modified)

## Integration with SEARLE

This app is designed to be extended with the SEARLE model for compose image retrieval. The CLIP encoding approach matches the requirements for SEARLE integration. 